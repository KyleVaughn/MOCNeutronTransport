#pragma once

#include <cassert> // assert
#include <concepts> // std::is_fundamental_v
#include <cstdint> // int32_t, int64_t

// Ignore clang-tidy in this case, since these are CMake defines
// NOLINTBEGIN(modernize-macro-to-enum) justified

//==============================================================================
// CMake defines
//==============================================================================

// OpenMP
#cmakedefine01 UM2_USE_OPENMP

// TBB
#cmakedefine01 UM2_USE_TBB

// Gmsh
#cmakedefine01 UM2_USE_GMSH

// libpng
#cmakedefine01 UM2_USE_PNG

// CUDA
#cmakedefine01 UM2_USE_CUDA

// Integer type in API
#cmakedefine01 UM2_ENABLE_INT64

// Floating point type in API
#cmakedefine01 UM2_ENABLE_FLOAT64

// Logging
#define MIN_LOG_LEVEL @UM2_MIN_LOG_LEVEL@

//==============================================================================
// Includes
//==============================================================================

#if UM2_USE_OPENMP
#  include <omp.h>
#endif

#if UM2_USE_CUDA
#  include <cuda_runtime.h>
#endif

//==============================================================================
// Attributes
//==============================================================================

// Optimization
#undef PURE
#undef CONST
#undef HOT
#undef HIDDEN
#define PURE  [[gnu::pure]]
#define CONST [[gnu::const]]
#define HOT   [[gnu::hot]]

// CUDA
#undef HOST
#undef DEVICE
#undef HOSTDEV
#undef GLOBAL
#if UM2_USE_CUDA
#  define HOST    __host__
#  define DEVICE  __device__
#  define HOSTDEV __host__ __device__
#  define GLOBAL  __global__
#else
#  define HOST
#  define DEVICE
#  define HOSTDEV
#  define GLOBAL
#endif

// API
#define HIDDEN __attribute__((visibility("hidden")))

//==============================================================================
// Typedefs
//==============================================================================

// Integer type for indices and integers in API.
#if UM2_ENABLE_INT64
using Size = int64_t; // Index type
using Int = int64_t;  // Integer type in API

HOSTDEV consteval auto
sizeMax() -> Size
{
  return 0x7FFFFFFFFFFFFFFF;
}

#else

using Size = int32_t; // Index type
using Int = int32_t;  // Integer type in API

consteval auto
HOSTDEV sizeMax() -> Size
{
  return 0x7FFFFFFF;
}

#endif

// Floating point type in API.
#if UM2_ENABLE_FLOAT64
using Float = double; // Floating point type in API
#else
using Float = float; // Floating point type in API
#endif

// Integer type for material IDs.
using MaterialID = int8_t;

// For static_asserts which are always false.
template <class... T>
constexpr bool always_false = false;

namespace um2
{
  template <class T>
  concept fundamental = std::is_fundamental_v<T>;

  template <class T>
  concept trivially_copyable = std::is_trivially_copyable_v<T>;
} // namespace um2

// NOLINTEND(modernize-macro-to-enum)
